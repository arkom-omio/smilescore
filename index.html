<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SmileScore ‚Äî –æ—Ü–µ–Ω–∫–∞ —É–ª—ã–±–∫–∏</title>
    <meta name="description" content="–õ–æ–∫–∞–ª—å–Ω–æ–µ –≤–µ–±‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: –ø–æ–∑–∏—Ç–∏–≤–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ —É–ª—ã–±–∫–∏ –ø–æ —Ñ–æ—Ç–æ. –ù–∏—á–µ–≥–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä." />
    <meta name="theme-color" content="#f6f6f6" />

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      html, body, #root { height:100% }
      body { background:#f6f6f6 }
      #err { position:fixed; inset:0; display:none; background:rgba(0,0,0,.92); color:#fff; padding:16px; z-index:99999; white-space:pre-wrap }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <div id="err"></div>

    <script>
      // –ü–æ–Ω—è—Ç–Ω—ã–π –æ–≤–µ—Ä–ª–µ–π –æ—à–∏–±–æ–∫
      addEventListener('error', (e) => {
        var el = document.getElementById('err');
        el.textContent = 'JS error: ' + ((e && e.message) || e);
        el.style.display = 'block';
      });
      addEventListener('unhandledrejection', (e) => {
        var el = document.getElementById('err');
        var r = e && e.reason;
        el.textContent = 'Promise: ' + ((r && (r.message || r)) || e);
        el.style.display = 'block';
      });
    </script>

    <!-- React + ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel –¥–ª—è JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <script type="text/babel" data-presets="env,react">
      /* ==== –æ–±–ª–µ–≥—á—ë–Ω–Ω—ã–µ "motion" —Å—Ç–∞–±—ã (–±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π) ==== */
      const AnimatePresence = ({ children }) => <>{children}</>;
      const motion = new Proxy({}, { get: (_t, tag) => (props) => React.createElement(tag, props) });
      /* ================================================================= */

      const { useEffect, useRef, useState } = React;
      const prettyDate = () => new Date().toLocaleString('ru-RU');
      const MAX_SIZE = 15 * 1024 * 1024;

      /* ===== –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–∞ –≤ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π dataURL (JPEG sRGB) ===== */
      async function fileToSafeDataURL(file){
        const src = await new Promise(function(res,rej){
          const fr=new FileReader(); fr.onload=()=>res(String(fr.result)); fr.onerror=rej; fr.readAsDataURL(file);
        });
        const img = await new Promise(function(res,rej){
          const im=new Image(); im.onload=()=>res(im); im.onerror=rej; im.src=src;
        });
        const maxSide = 1400;
        const scale = Math.min(1, maxSide/Math.max(img.width, img.height));
        const w = Math.max(1, Math.round(img.width*scale));
        const h = Math.max(1, Math.round(img.height*scale));
        const c = document.createElement('canvas'); c.width=w; c.height=h;
        const x = c.getContext('2d');
        x.imageSmoothingEnabled = true; x.imageSmoothingQuality = 'high';
        x.drawImage(img,0,0,w,h);
        return c.toDataURL('image/jpeg', 0.92);
      }

      /* ===== –ü–æ–ª—É—á–µ–Ω–∏–µ ImageData –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ ===== */
      function useImageData(url){
        const [data,setData] = useState(null);
        useEffect(function(){
          let active=true;
          (async function(){
            if(!url){ setData(null); return; }
            const img=new Image(); img.crossOrigin='anonymous';
            img.onload=function(){
              if(!active) return;
              const maxSide=640, sc=Math.min(1,maxSide/Math.max(img.width,img.height));
              const w=Math.max(1,Math.round(img.width*sc)), h=Math.max(1,Math.round(img.height*sc));
              const c=document.createElement('canvas'); c.width=w; c.height=h;
              const x=c.getContext('2d'); if(!x){ setData(null); return; }
              x.imageSmoothingEnabled = true; x.imageSmoothingQuality = 'high';
              x.drawImage(img,0,0,w,h);
              try{ setData(x.getImageData(0,0,w,h)); }catch(e){ setData(null); }
            };
            img.onerror=function(){ setData(null); };
            img.src=url;
          })();
          return function(){ active=false; };
        },[url]);
        return data;
      }

      function analyzeJoy(imageData){
        if(!imageData) return {brightness:0.6,saturation:0.4,warmth:0.5};
        const data=imageData.data, width=imageData.width, height=imageData.height;
        const step=Math.max(2,Math.round(Math.max(width,height)/160));
        var n=0, sb=0, ss=0, sw=0;
        for(var y=0;y<height;y+=step){
          for(var x=0;x<width;x+=step){
            const i=(y*width+x)*4, r=data[i]/255, g=data[i+1]/255, b=data[i+2]/255;
            const max=Math.max(r,g,b), min=Math.min(r,g,b);
            const l=0.299*r+0.587*g+0.114*b;
            const s=max===0?0:(max-min)/max;
            const w=Math.min(1, Math.max(0, (r-b+1)/2));
            sb+=l; ss+=s; sw+=w; n++;
          }
        }
        return {brightness:sb/n, saturation:ss/n, warmth:sw/n};
      }
      function scoreFromMetrics(m){
        const joy=0.5*m.brightness+0.3*m.saturation+0.2*m.warmth;
        const raw=Math.max(0.4, Math.min(1, joy + Math.random()*0.08));
        return Math.max(70, Math.min(100, Math.round(70 + raw*30)));
      }
      function verdict(s){
        if(s>=95) return "–û—Å–ª–µ–ø–∏—Ç–µ–ª—å–Ω–∞—è —É–ª—ã–±–∫–∞ ‚ú®";
        if(s>=90) return "–í–∞—É! –£–ª—ã–±–∫–∞ –∫–∞–∫ —É –∫–∏–Ω–æ–∑–≤–µ–∑–¥—ã";
        if(s>=85) return "–û—á–µ–Ω—å —Ç—ë–ø–ª–∞—è –∏ –∏—Å–∫—Ä–µ–Ω–Ω—è—è";
        if(s>=80) return "–°–∏—è—é—â–∞—è –∏ –¥—Ä—É–∂–µ–ª—é–±–Ω–∞—è";
        if(s>=75) return "–ú—è–≥–∫–∞—è, —Å–≤–µ—Ç–ª–∞—è –∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞—è";
        return "–ù–µ–∂–Ω–∞—è –∏ –ø—Ä–∏—Ç—è–≥–∞—Ç–µ–ª—å–Ω–∞—è";
      }

      function useCountUp(target, dur=1200){
        const [v,setV]=useState(0);
        useEffect(function(){
          let r=0, s=performance.now();
          const tick=function(t){ const p=Math.min(1,(t-s)/dur), e=1-Math.pow(1-p,3); setV(Math.round(target*e)); if(p<1) r=requestAnimationFrame(tick); };
          r=requestAnimationFrame(tick); return function(){ cancelAnimationFrame(r); };
        },[target,dur]);
        return v;
      }
      function ScoreRing({score}){
        const R=84, SW=12, C=2*Math.PI*R, pct=score/100, dash=C*pct, gap=C-dash, d=useCountUp(score);
        return (<div className="relative w-[220px] h-[220px]" aria-label={`–°—á—ë—Ç ${score} –∏–∑ 100`} role="img">
          <svg viewBox={`0 0 ${2*(R+SW)} ${2*(R+SW)}`} className="w-full h-full" aria-hidden="true">
            <defs>
              <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
                <stop offset="0%" stopColor="#1b2d6f"/>
                <stop offset="100%" stopColor="#10afab"/>
              </linearGradient>
            </defs>
            <g transform={`translate(${SW},${SW})`}>
              <circle cx={R} cy={R} r={R} stroke="rgba(27,45,111,0.18)" strokeWidth={SW} fill="none"/>
              <circle cx={R} cy={R} r={R} stroke="url(#g)" strokeWidth={SW} fill="none" strokeLinecap="round" strokeDasharray={`${dash} ${gap}`} transform={`rotate(-90 ${R} ${R})`}/>
            </g>
          </svg>
          <div className="absolute inset-0 grid place-items-center">
            <div className="text-center"><div className="text-6xl font-semibold tracking-tight text-[#1b2d6f]">{d}</div><div className="mt-1 text-[#1b2d6f]/70">–∏–∑ 100</div></div>
          </div>
        </div>);
      }
      function Metric({label,value}){ const pct=Math.round(value*100);
        return(<div className="rounded-2xl border border-[#1b2d6f]/10 bg-white p-3" role="group" aria-label={label}>
          <div className="text-xs text-[#1b2d6f]/70 mb-2">{label}</div>
          <div className="flex items-center gap-3">
            <div className="relative h-2 flex-1 rounded-full bg-[#1b2d6f]/10 overflow-hidden" aria-hidden="true">
              <div className="absolute inset-y-0 left-0 rounded-full bg-gradient-to-r from-[#1b2d6f] to-[#10afab]" style={{width:`${pct}%`}}/>
            </div>
            <div className="text-sm text-[#1b2d6f] w-10 text-right tabular-nums" aria-live="polite">{pct}%</div>
          </div>
        </div>);
      }
      function Toast({message,onClose}){ React.useEffect(function(){ const id=setTimeout(onClose,2400); return function(){ clearTimeout(id); }; },[onClose]);
        return <div className="fixed right-4 bottom-4 z-50 rounded-2xl bg-[#1b2d6f] text-white px-4 py-3 shadow-lg" role="status" aria-live="polite">{message}</div>;
      }

      /* ===== Drag&Drop –∑–∞–≥—Ä—É–∑–∫–∞ ===== */
      function DropZone({ onFile }){
        const inputRef=useRef(null);
        const [drag,setDrag]=useState(false);
        const [focused,setFocused]=useState(false);

        function handleFile(f){
          if(!f) return;
          const name = (f.name || '').toLowerCase();
          const isImageMime = /^image\//.test(f.type);
          const isHeic = /\.(heic|heif)$/i.test(name);
          if (!isImageMime && !/\.(png|jpe?g|webp|gif|bmp)$/i.test(name) && !isHeic) {
            alert('–ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (JPG/PNG/WebP/GIF/BMP)');
            return;
          }
          if (isHeic) { alert('HEIC/HEIF —á–∞—Å—Ç–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–æ—Ç–æ –∫–∞–∫ JPG/PNG.'); return; }
          if (f.size > MAX_SIZE) { alert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–ª–∏–º–∏—Ç 15MB)'); return; }
          onFile(f);
        }
        function handlePaste(e){
          var items=e.clipboardData&&e.clipboardData.items; if(!items) return;
          for(var i=0;i<items.length;i++){
            var it=items[i];
            if (/^image\//.test(it.type)) { var f=it.getAsFile(); if(f){ handleFile(f); break; } }
          }
        }
        return(<div
          onDragOver={e=>{e.preventDefault(); setDrag(true);}}
          onDragLeave={()=>setDrag(false)}
          onDrop={e=>{e.preventDefault(); setDrag(false); handleFile(e.dataTransfer.files&&e.dataTransfer.files[0]);}}
          onPaste={handlePaste}
          onClick={()=>{ if(inputRef.current) inputRef.current.click(); }}
          onKeyDown={e=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); if(inputRef.current) inputRef.current.click(); } }}
          tabIndex={0} onFocus={()=>setFocused(true)} onBlur={()=>setFocused(false)}
          role="button" aria-label="–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é"
          className={["group relative flex flex-col items-center justify-center","h-[280px] rounded-3xl border-2 border-dashed",
            (drag||focused)?"border-[#1b2d6f]/40":"border-[#1b2d6f]/20","bg-white","p-8 md:p-12 text-center cursor-pointer transition-colors",
            drag?"ring-2 ring-[#1b2d6f]/30 bg-[#10afab]/5":"hover:bg-[#10afab]/5",focused?"outline-none ring-2 ring-[#10afab]/40":""].join(" ")}
        >
          <div className="mb-4 inline-flex h-16 w-16 items-center justify-center rounded-2xl bg-[#10afab]/10">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" className="opacity-90 text-[#1b2d6f]">
              <path d="M12 16V4" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/>
              <path d="M7 9l5-5 5 5" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/>
              <rect x="3" y="12" width="18" height="8" rx="2" stroke="currentColor" strokeWidth="1.5"/>
            </svg>
          </div>
          <div className="text-xl md:text-2xl font-semibold text-[#1b2d6f]">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ —Å—é–¥–∞</div>
          <div className="mt-2 text-[#1b2d6f]/70">–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª ¬∑ Ctrl/Cmd+V ‚Äî –≤—Å—Ç–∞–≤–∏—Ç—å</div>
          <input ref={inputRef} type="file" accept="image/*" className="hidden" onChange={e=>handleFile(e.currentTarget.files && e.currentTarget.files[0])}/>
        </div>);
      }

      /* ======================= –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ======================= */
      function App(){
        const [file,setFile]=useState(null);
        const [imgURL,setImgURL]=useState(null);
        const [imgTooDark,setImgTooDark]=useState(false);
        const [score,setScore]=useState(null);
        const [metrics,setMetrics]=useState(null);
        const [busy,setBusy]=useState(false);
        const [autoAnalyze,setAutoAnalyze]=useState(true);
        const [history,setHistory]=useState([]);
        const [toast,setToast]=useState(null);

        async function acceptFile(f){
          try{
            setScore(null); setMetrics(null); setImgTooDark(false);
            const safe=await fileToSafeDataURL(f);
            setImgURL(safe);
            setFile(f);
          }catch(e){ alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ JPG/PNG.'); }
        }

        const imageData=useImageData(imgURL);
        useEffect(function(){
          if(!imgURL){ setMetrics(null); setScore(null); return; }
          const m=analyzeJoy(imageData); setMetrics(m); setScore(null);
          const dark = m && m.brightness<0.02 && m.saturation<0.02;
          setImgTooDark(!!dark);
        },[imgURL,imageData]);

        useEffect(function(){
          if(!autoAnalyze||!imgURL||!metrics) return;
          if(score!=null||busy) return;
          (async function(){ await handleAnalyze(); })();
        },[autoAnalyze,imgURL,metrics,score,busy]);

        async function handleAnalyze(){
          if(!imgURL){ setToast('–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ'); return; }
          setBusy(true);
          var m = metrics || analyzeJoy(imageData); if(!m) m=analyzeJoy(null);
          if(!metrics) setMetrics(m);
          await new Promise(function(r){ setTimeout(r,320); });
          const s=scoreFromMetrics(m); setScore(s); setBusy(false); setToast('–ì–æ—Ç–æ–≤–æ! –£–ª—ã–±–∫–∞ –æ—Ü–µ–Ω–µ–Ω–∞ üòä');
          if(file){
            try{ setHistory(function(prev){ return [{url:imgURL,score:s,verdict:verdict(s),date:prettyDate()}].concat(prev).slice(0,6); }); }catch(e){}
          }
        }

        function reset(){ setFile(null); setImgURL(null); setImgTooDark(false); setScore(null); setMetrics(null); }

        async function exportPNG(){
          if(!score || !imgURL) return;
          const W=1080,H=1350,c=document.createElement('canvas'); c.width=W; c.height=H; const ctx=c.getContext('2d'); if(!ctx) return;
          // –°–≤–µ—Ç–ª—ã–π —Ñ–æ–Ω + –º—è–≥–∫–∏–µ –∞–∫—Ü–µ–Ω—Ç—ã
          ctx.fillStyle='#f6f6f6'; ctx.fillRect(0,0,W,H);
          const rg=ctx.createRadialGradient(W*0.8,H*0.1,0,W*0.8,H*0.1,W*0.6); rg.addColorStop(0,'rgba(16,175,171,0.18)'); rg.addColorStop(1,'transparent'); ctx.fillStyle=rg; ctx.fillRect(0,0,W,H);

          const img=await new Promise(function(res,rej){ const im=new Image(); im.crossOrigin='anonymous'; im.onload=function(){res(im)}; im.onerror=function(){rej()}; im.src=imgURL; });

          const px=90,py=140,pw=W-180,ph=620,r=36;
          ctx.save(); ctx.beginPath(); ctx.moveTo(px+r,py); ctx.arcTo(px+pw,py,px+pw,py+ph,r); ctx.arcTo(px+pw,py+ph,px,py+ph,r); ctx.arcTo(px,py+ph,px,py,r); ctx.arcTo(px,py,px+pw,py,r); ctx.closePath(); ctx.clip();
          const ir=img.width/img.height, fr=pw/ph; var dw=pw,dh=ph,dx=px,dy=py;
          if(ir>fr){ dh=ph; dw=ph*ir; dx=px-(dw-pw)/2; } else { dw=pw; dh=pw/ir; dy=py-(dh-ph)/2; }
          ctx.drawImage(img,dx,dy,dw,dh); ctx.restore();

          // –¢–µ–∫—Å—Ç –∏ –∫–æ–ª—å—Ü–æ –≤ –Ω–æ–≤–æ–π –ø–∞–ª–∏—Ç—Ä–µ
          ctx.fillStyle='#1b2d6f'; ctx.font='600 68px system-ui,-apple-system,Segoe UI,Roboto'; ctx.fillText('SmileScore',90,980);
          const cx=260,cy=1120,rr=120,sw=18; ctx.strokeStyle='rgba(27,45,111,0.2)'; ctx.lineWidth=sw; ctx.lineCap='round'; ctx.beginPath(); ctx.arc(cx,cy,rr,0,Math.PI*2); ctx.stroke();
          const grad=ctx.createLinearGradient(cx-rr,cy-rr,cx+rr,cy+rr); grad.addColorStop(0,'#1b2d6f'); grad.addColorStop(1,'#10afab'); ctx.strokeStyle=grad;
          const end=(-Math.PI/2)+(Math.PI*2)*(score/100); ctx.beginPath(); ctx.arc(cx,cy,rr,-Math.PI/2,end); ctx.stroke();
          ctx.textAlign='center'; ctx.font='600 64px system-ui,-apple-system,Segoe UI,Roboto'; ctx.fillText(String(score),cx,cy+24);
          ctx.textAlign='left'; ctx.font='600 48px system-ui,-apple-system,Segoe UI,Roboto'; ctx.fillText(verdict(score),430,1100);
          ctx.font='32px system-ui,-apple-system,Segoe UI,Roboto'; ctx.fillStyle='rgba(27,45,111,0.75)'; ctx.fillText('–î–∞—Ç–∞ –æ—Ü–µ–Ω–∫–∏: '+prettyDate(),430,1150);
          await new Promise(function(r){ c.toBlob(function(b){ if(!b) return; const url=URL.createObjectURL(b); const a=document.createElement('a'); a.href=url; a.download='SmileScore.png'; a.click(); URL.revokeObjectURL(url); r(); },'image/png'); });
        }

        const gradientBg = "bg-[#f6f6f6] bg-[radial-gradient(1200px_600px_at_80%_-10%,rgba(27,45,111,0.08),transparent_60%),radial-gradient(900px_500px_at_20%_120%,rgba(16,175,171,0.12),transparent_60%)]";

        return (
          <div className={'min-h-screen text-[#1b2d6f] selection:bg-[#10afab]/30 selection:text-[#1b2d6f] '+gradientBg}>
            <div className="pointer-events-none fixed inset-0 -z-10 opacity-40 [background:linear-gradient(to_right,rgba(27,45,111,0.06)_1px,transparent_1px),linear-gradient(to_bottom,rgba(27,45,111,0.06)_1px,transparent_1px)] [background-size:32px_32px]" />

            <div className="sticky top-0 z-30 backdrop-blur-xl bg-white/70 border-b border-[#1b2d6f]/10">
              <div className="mx-auto max-w-6xl px-4 py-3 flex items-center justify-between">
                <div className="flex items-center gap-3"><div className="h-6 w-6 rounded-[8px] bg-gradient-to-br from-[#1b2d6f] to-[#10afab] shadow-inner" /><span className="text-sm tracking-wide text-[#1b2d6f]/80">SmileScore</span></div>
                <div className="text-xs text-[#1b2d6f]/60">{prettyDate()}</div>
              </div>
            </div>

            <main className="mx-auto max-w-6xl px-4 py-10 md:py-16">
              <div className="max-w-3xl">
                <motion.h1 initial={{opacity:0,y:10}} animate={{opacity:1,y:0}} transition={{duration:0.6}}
                  className="text-4xl md:text-6xl font-semibold tracking-tight bg-gradient-to-br from-[#1b2d6f] to-[#1b2d6f]/70 bg-clip-text text-transparent">
                  –û—Ü–µ–Ω–∫–∞ —É–ª—ã–±–∫–∏ <span className="text-[#1b2d6f]/60">–ø–æ —Ñ–æ—Ç–æ</span>
                </motion.h1>
                <p className="mt-4 text-[#1b2d6f]/80 text-lg md:text-xl">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–æ—Ä—Ç—Ä–µ—Ç ‚Äî –∏ –ø–æ–ª—É—á–∏—Ç–µ –±–µ—Ä–µ–∂–Ω—É—é, –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—â—É—é –æ—Ü–µ–Ω–∫—É. –¢–æ–ª—å–∫–æ –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ –≤–∏–±—Ä–∞—Ü–∏–∏ ‚úåÔ∏è</p>
              </div>

              <div className="mt-10 grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div className="space-y-4">
                  {!imgURL ? (
                    <DropZone onFile={acceptFile}/>
                  ) : (
                    <div className="relative overflow-hidden rounded-3xl border border-[#1b2d6f]/10 bg-white shadow-sm">
                      <div className="absolute inset-0 pointer-events-none bg-[radial-gradient(600px_240px_at_10%_10%,rgba(16,175,171,0.06),transparent)]"/>
                      <img src={imgURL||''} alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä" className="w-full h-[420px] object-cover block"/>
                      <div className="absolute left-4 top-4 inline-flex items-center gap-2 rounded-2xl bg-[#1b2d6f]/10 px-3 py-1.5 backdrop-blur">
                        <span className="inline-block h-2 w-2 rounded-full bg-[#10afab] animate-pulse"/><span className="text-xs text-[#1b2d6f]/80">–§–æ—Ç–æ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</span>
                      </div>
                      {imgTooDark && (
                        <div className="absolute inset-0 grid place-items-center bg-white/80 text-center p-6">
                          <div className="text-[#1b2d6f]">
                            <div className="text-lg font-semibold mb-1">–ö–∞–¥—Ä –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–∏—à–∫–æ–º —Ç—ë–º–Ω—ã–º</div>
                            <div className="text-[#1b2d6f]/80 text-sm">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–µ —Ñ–æ—Ç–æ –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞–∫ JPG/PNG –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–Ω–æ–≤–∞.</div>
                          </div>
                        </div>
                      )}
                      <div className="absolute right-4 bottom-4 flex gap-2">
                        <button onClick={reset} className="rounded-xl border border-[#1b2d6f]/20 hover:bg-[#10afab]/10 px-3 py-2 text-sm text-[#1b2d6f]">–ó–∞–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ</button>
                      </div>
                    </div>
                  )}

                  <div className="flex flex-wrap items-center gap-3">
                    <button onClick={handleAnalyze} disabled={!imgURL || busy}
                      className="rounded-2xl bg-[#10afab] text-white px-5 py-3 text-sm font-medium shadow disabled:opacity-40 disabled:cursor-not-allowed">
                      {busy?'–ê–Ω–∞–ª–∏–∑‚Ä¶':'–û—Ü–µ–Ω–∏—Ç—å —É–ª—ã–±–∫—É'}
                    </button>
                    <button onClick={exportPNG} disabled={!score || !imgURL}
                      className="rounded-2xl border border-[#1b2d6f]/20 hover:bg-[#10afab]/10 px-4 py-3 text-sm text-[#1b2d6f] disabled:opacity-40 disabled:cursor-not-allowed">
                      –°–æ—Ö—Ä–∞–Ω–∏—Ç—å PNG
                    </button>
                    <label className="flex items-center gap-2 text-[#1b2d6f]/80 text-sm select-none">
                      <input type="checkbox" checked={autoAnalyze} onChange={e=>setAutoAnalyze(e.currentTarget.checked)} className="accent-[#10afab]"/> –ê–≤—Ç–æ‚Äë–æ—Ü–µ–Ω–∫–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
                    </label>
                  </div>

                  {history.length>0 && (<div className="mt-2" aria-live="polite">
                    <div className="mb-2 text-[#1b2d6f]/70 text-sm">–ò—Å—Ç–æ—Ä–∏—è</div>
                    <div className="grid grid-cols-3 md:grid-cols-6 gap-2">
                      {history.map((h,i)=>(
                        <button key={i} onClick={()=>{ setImgURL(h.url); setScore(h.score); setToast('–û—Ç–∫—Ä—ã–ª–∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç'); }}
                          className="relative group rounded-xl overflow-hidden border border-[#1b2d6f]/10 bg-white">
                          <img src={h.url} alt={'result-'+i} className="h-24 w-full object-cover" loading="lazy"/>
                          <div className="absolute inset-0 bg-[#1b2d6f]/10 opacity-0 group-hover:opacity-100 transition-opacity"/>
                          <div className="absolute left-1.5 bottom-1.5 px-1.5 py-0.5 rounded-lg bg-white/80 text-[#1b2d6f] text-[11px]">{h.score}</div>
                        </button>
                      ))}
                    </div>
                  </div>)}
                </div>

                <div className="relative overflow-hidden rounded-3xl border border-[#1b2d6f]/10 bg-white p-6 md:p-8 shadow-sm">
                  <div className="absolute inset-0 pointer-events-none bg-[radial-gradient(500px_200px_at_85%_15%,rgba(27,45,111,0.07),transparent)]"/>
                  <div className="flex flex-col items-center justify-center min-h-[420px] text-center">
                    <AnimatePresence mode="wait">
                      {score==null ? (
                        <motion.div key="empty" initial={{opacity:0,y:6}} animate={{opacity:1,y:0}} exit={{opacity:0,y:-6}} transition={{duration:0.4}} className="text-[#1b2d6f]/70">
                          <div className="text-2xl md:text-3xl">–ì–æ—Ç–æ–≤—ã —É–≤–∏–¥–µ—Ç—å —Å–≤–æ—é –ª—É—á–µ–∑–∞—Ä–Ω–æ—Å—Ç—å? ‚ú®</div>
                          <div className="mt-2">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–û—Ü–µ–Ω–∏—Ç—å —É–ª—ã–±–∫—É¬ª</div>
                        </motion.div>
                      ) : (
                        <motion.div key="score" initial={{opacity:0,y:10}} animate={{opacity:1,y:0}} exit={{opacity:0,y:-10}} transition={{duration:0.5}} className="w-full" aria-live="polite">
                          <div className="flex flex-col items-center gap-6">
                            <ScoreRing score={score}/>
                            <div className="text-2xl md:text-3xl font-semibold tracking-tight text-[#1b2d6f]">{verdict(score)}</div>
                            {metrics && (<div className="grid grid-cols-3 gap-3 w-full max-w-md">
                              <Metric label="–û—Å–≤–µ—â—ë–Ω–Ω–æ—Å—Ç—å" value={metrics.brightness}/>
                              <Metric label="–ù–∞—Å—ã—â–µ–Ω–Ω–æ—Å—Ç—å" value={metrics.saturation}/>
                              <Metric label="–¢—ë–ø–ª—ã–µ —Ç–æ–Ω–∞" value={metrics.warmth}/>
                            </div>)}
                            <div className="text-xs text-[#1b2d6f]/60">–î–∞—Ç–∞ –æ—Ü–µ–Ω–∫–∏: {prettyDate()}</div>
                          </div>
                        </motion.div>
                      )}
                    </AnimatePresence>
                  </div>
                </div>
              </div>

              <div className="mt-10 text-center text-[#1b2d6f]/60 text-sm">–°–æ–∑–¥–∞–Ω–æ —Å –∑–∞–±–æ—Ç–æ–π. –≠—Ç–æ —Ä–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –∏ –≤—Å–µ–≥–¥–∞ –ø–æ–∑–∏—Ç–∏–≤–Ω–∞—è. –£–ª—ã–±–Ω–∏—Ç–µ—Å—å —Å–µ–≥–æ–¥–Ω—è –∫–æ–º—É‚Äë–Ω–∏–±—É–¥—å üòä</div>
            </main>

            {toast && <Toast message={toast} onClose={()=>setToast(null)}/>}
          </div>
        );
      }

      // sanity-check
      (function(){ function within(s){ return s>=70 && s<=100; } console.assert(within(scoreFromMetrics({brightness:0.5,saturation:0.5,warmth:0.5}))); })();

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App/>);
    </script>
  </body>
</html>
